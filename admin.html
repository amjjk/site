<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Kendence F.C.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1a202c; color: white; }
        
        /* --- ESTILOS DO LOGIN (NOVO) --- */
        #login-screen { background-color: rgba(26, 32, 44, 0.95); z-index: 50; }
        .login-box { background-color: #2d3748; padding: 2.5rem; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .login-input { background-color: #4a5568; border: 1px solid #718096; color: white; border-radius: 0.375rem; padding: 0.75rem 1rem; }
        .login-btn { background-color: #4299e1; color: white; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .login-btn:hover { background-color: #2b6cb0; }
        #login-error { color: #e53e3e; font-size: 0.875rem; margin-top: 0.5rem; display: none; } /* Mensagem de erro oculta por padrão */
        
        /* --- ESTILOS DO PAINEL ADMIN --- */
        #admin-panel { display: none; } /* Painel oculto initially */
        .form-section, .backup-section { background-color: #2d3748; padding: 2rem; border-radius: 0.5rem; margin-bottom: 2rem; }
        .form-input { background-color: #4a5568; border: 1px solid #718096; color: white; border-radius: 0.375rem; }
        .form-input::-webkit-calendar-picker-indicator { filter: invert(1); }
        .btn { padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .btn-primary { background-color: #4299e1; color: white; }
        .btn-primary:hover { background-color: #2b6cb0; }
        .btn-danger { background-color: #e53e3e; color: white; }
        .btn-danger:hover { background-color: #c53030; }
        .btn-secondary { background-color: #718096; color: white; }
        .btn-secondary:hover { background-color: #4a5568; }
        .btn-success { background-color: #38a169; color: white; }
        .btn-success:hover { background-color: #2f855a; }
        #data-display { max-height: 400px; overflow-y: auto; background-color: #1a202c; padding: 1rem; border-radius: 0.5rem; border: 1px solid #4a5568; }
        .url-input-container { display: flex; align-items: center; border: 1px solid #718096; border-radius: 0.375rem; background-color: #4a5568; }
        .url-base { background-color: #2d3748; padding: 0.5rem; white-space: nowrap; border-right: 1px solid #718096; }
        .url-final-input { border: none; outline: none; padding: 0.5rem; width: 100%; background-color: transparent; color: white; }
    </style>
</head>
<body class="p-8 font-sans">

    <div id="login-screen" class="fixed inset-0 flex items-center justify-center">
        <div class="login-box w-full max-w-sm">
            
            <img src="https://lh3.googleusercontent.com/d/1c5dDZYwAcdPoD8H-_5pBbkgwISvSG63l" alt="Brasão Kendence F.C." class="w-32 h-27 mx-auto mb-4">
            <h1 class="text-3xl font-bold text-center mb-6">Admin Login</h1>
            <form id="login-form">
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium mb-1">E-mail</label>
                    <input type="email" id="email" class="login-input w-full" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium mb-1">Senha</label>
                    <input type="password" id="password" class="login-input w-full" required>
                </div>
                <button type="submit" class="login-btn w-full">Entrar</button>
                <p id="login-error">E-mail ou senha inválidos.</p> </form>
        </div>
    </div>
    
    <div id="admin-panel"> 
        <div class="fixed top-4 right-4 z-50 flex items-center space-x-4">
            <button onclick="logout()" class="btn btn-danger py-1 px-3 text-sm">Sair</button>
            <img src="https://lh3.googleusercontent.com/d/1c5dDZYwAcdPoD8H-_5pBbkgwISvSG63l" alt="Brasão" class="w-16 h-12 rounded-full">
        </div>

        <h1 class="text-4xl font-bold text-center mb-8">Painel de Administração - Kendence F.C.</h1>

        <div class="backup-section text-center">
            <h2 class="text-2xl font-bold mb-4">Backup e Restauração</h2>
            <p class="text-sm text-gray-400 mb-4">Faça backup de todos os dados ou restaure a partir de um arquivo .json.</p>
            <div class="flex justify-center space-x-4">
                <button onclick="backupData()" class="btn btn-success">Fazer Backup</button>
                <button onclick="triggerRestore()" class="btn btn-danger">Restaurar Backup</button>
                <input type="file" id="restore-file-input" class="hidden" accept=".json" onchange="restoreData(event)">
            </div>
        </div>

        <div class="mb-8">
            <label for="section-select" class="block mb-2 text-lg font-medium">Selecione a área para gerenciar:</label>
            <select id="section-select" class="form-input w-full p-3" onchange="showForm(this.value)">
                <option value="upcomingGames">Próximos Jogos</option>
                <option value="recentResults">Resultados Recentes</option>
                <option value="news">Notícias</option>
                <option value="players">Jogadores</option>
                <option value="sponsors">Patrocinadores</option>
            </select>
        </div>

        <div id="forms-container">
            <div id="form-upcomingGames" class="form-section">
                <h2 class="text-2xl font-bold mb-4">Gerenciar Próximos Jogos</h2>
                <form id="upcomingGames-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="hidden" id="upcomingGames-id">
                    <div>
                        <label for="upcomingGames-date-input" class="block text-sm font-medium mb-1">Data do Jogo</label>
                        <input type="date" id="upcomingGames-date-input" class="form-input p-2 w-full" required>
                    </div>
                    <div>
                        <label for="upcomingGames-time-input" class="block text-sm font-medium mb-1">Hora do Jogo</label>
                        <input type="time" id="upcomingGames-time-input" class="form-input p-2 w-full" required>
                    </div>
                    <input type="text" id="upcomingGames-teams" placeholder="Times (ex: Kendence vs. Time B)" class="form-input p-2" required>
                    <input type="text" id="upcomingGames-location" placeholder="Nome do Campo" class="form-input p-2" required>
                    <input type="url" id="upcomingGames-mapLink" placeholder="Link do Google Maps" class="form-input p-2 col-span-1 md:col-span-2" required>
                    <div class="col-span-1 md:col-span-2 flex space-x-2">
                        <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                        <button type="button" onclick="clearForm('upcomingGames')" class="btn btn-secondary">Limpar</button>
                    </div>
                </form>
            </div>
            <div id="form-recentResults" class="form-section hidden">
                <h2 class="text-2xl font-bold mb-4">Gerenciar Resultados Recentes</h2>
                <form id="recentResults-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="hidden" id="recentResults-id">
                     <div>
                        <label for="recentResults-date-input" class="block text-sm font-medium mb-1">Data do Jogo</label>
                        <input type="date" id="recentResults-date-input" class="form-input p-2 w-full" required>
                    </div>
                    <div>
                        <label for="recentResults-time-input" class="block text-sm font-medium mb-1">Hora do Jogo</label>
                        <input type="time" id="recentResults-time-input" class="form-input p-2 w-full" required>
                    </div>
                    <input type="text" id="recentResults-match" placeholder="Resultado (ex: Kendence 3 x 2 Time B)" class="form-input p-2" required>
                    <input type="text" id="recentResults-location" placeholder="Nome do Campo" class="form-input p-2" required>
                    <input type="url" id="recentResults-videoLink" placeholder="Link para Fotos/Vídeos" class="form-input p-2 col-span-1 md:col-span-2" required>
                    <div class="col-span-1 md:col-span-2 flex space-x-2">
                        <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                        <button type="button" onclick="clearForm('recentResults')" class="btn btn-secondary">Limpar</button>
                    </div>
                </form>
            </div>
            
            <div id="form-news" class="form-section hidden">
                <h2 class="text-2xl font-bold mb-4">Gerenciar Notícias</h2>
                <form id="news-form" class="grid grid-cols-1 gap-4">
                    <input type="hidden" id="news-id">
                    <input type="date" id="news-date" class="form-input p-2" required>
                    <input type="text" id="news-title" placeholder="Título da Notícia" class="form-input p-2" required>
                    <div>
                        <label for="news-image-final" class="block text-sm font-medium mb-1">URL da Imagem</label>
                        <div class="url-input-container">
                            <span class="url-base" id="news-baseUrl">https://lh3.googleusercontent.com/d/</span>
                            <input type="text" id="news-image-final" class="url-final-input" placeholder="cole o final da URL aqui" required>
                        </div>
                    </div>
                    <textarea id="news-text" placeholder="Texto da Notícia" rows="5" class="form-input p-2" required></textarea>
                    <div class="flex space-x-2">
                        <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                        <button type="button" onclick="clearForm('news')" class="btn btn-secondary">Limpar</button>
                    </div>
                </form>
            </div>

            <div id="form-players" class="form-section hidden">
                <h2 class="text-2xl font-bold mb-4">Gerenciar Jogadores e Comissão</h2>
                <form id="players-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="hidden" id="players-id">
                    <input type="text" id="players-name" placeholder="Nome do Jogador" class="form-input p-2" required>
                    <select id="players-role" class="form-input p-2" required>
                        <option value="">Selecione a Função</option>
                        <option value="Técnico">Técnico</option>
                        <option value="Auxiliar técnico">Auxiliar técnico</option>
                        <option value="Preparador físico">Preparador físico</option>
                        <option value="Fisioterapeuta">Fisioterapeuta</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Analista de desempenho">Analista de desempenho</option>
                        <option value="Fotografo">Fotografo</option>
                        <option value="Diretor">Diretor</option>
                        <option value="Preparador de goleiros">Preparador de goleiros</option>
                        <option value="Goleiro">Goleiro</option>
                        <option value="Zagueiro e Volante">Zagueiro e Volante</option>
                        <option value="Lateral">Lateral</option>
                        <option value="Meio">Meio-Campo</option>
                        <option value="Atacante">Atacante</option>
                        <option value="Gandula">Gandula</option>
                    </select>
                    <textarea id="players-description" placeholder="Descrição (ex:Apelido, Número da camisa, Idade, Altura, Peso, Pé Dominante, )" rows="4" class="form-input p-2 col-span-1 md:col-span-2"></textarea>
                    <div class="col-span-1 md:col-span-2 flex space-x-2">
                        <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                        <button type="button" onclick="clearForm('players')" class="btn btn-secondary">Limpar</button>
                    </div>
                </form>
            </div>

            <div id="form-sponsors" class="form-section hidden">
                <h2 class="text-2xl font-bold mb-4">Gerenciar Patrocinadores</h2>
                <form id="sponsors-form" class="grid grid-cols-1 gap-4">
                    <input type="hidden" id="sponsors-id">
                    <input type="text" id="sponsors-name" placeholder="Nome do Patrocinador" class="form-input p-2" required>
                    <div>
                        <label for="sponsors-image-final" class="block text-sm font-medium mb-1">URL da Imagem</label>
                        <div class="url-input-container">
                            <span class="url-base" id="sponsors-baseUrl">https://lh3.googleusercontent.com/d/</span>
                            <input type="text" id="sponsors-image-final" class="url-final-input" placeholder="cole o final da URL aqui" required>
                        </div>
                    </div>
                    <input type="url" id="sponsors-link" placeholder="Link do Patrocinador (ex: Instagram, Website)" class="form-input p-2" required>
                    <div class="flex space-x-2">
                        <button type="submit" class="btn btn-primary">Adicionar / Salvar</button>
                        <button type="button" onclick="clearForm('sponsors')" class="btn btn-secondary">Limpar</button>
                    </div>
                </form>
            </div>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">Dados Atuais</h2>
        <div id="data-display" class="mb-8">
            </div>
    </div>
    
    <script type="module">
        // Importa a biblioteca principal do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        // Importa o módulo de Autenticação e as funções de login e logout
        import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        // Importa o módulo do Realtime Database (ou Firestore)
        import { getDatabase, ref, push, set, onValue, remove, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
        // Importa o módulo de Analytics (se você estiver usando)
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";

        // --- CONFIGURAÇÃO E INICIALIZAÇÃO DO FIREBASE (Movido para o escopo principal) ---
        // Seus dados de configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAz1fgGgpB7F05-watfO69vi6Mpzgw1uMs",
            authDomain: "kendencefc-66b8b.firebaseapp.com",
            projectId: "kendencefc-66b8b",
            storageBucket: "kendencefc-66b8b.firebasestorage.app",
            messagingSenderId: "405923587103",
            appId: "1:405923587103:web:b74f3a37deff2f07bc212a",
            measurementId: "G-HLVLC7D0VD"
        };
        
        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app); 
        // Armazena as referências de serviço em constantes globais
        const database = getDatabase(app); 
        const auth = getAuth(app); // Instância do Auth (Necessária para o login)

        // --- Variáveis e Configurações Globais (RESTANTE DO CÓDIGO ORIGINAL) ---
        const sections = {
            upcomingGames: {
                dbRef: 'upcomingGames',
                formId: 'upcomingGames-form',
                titleField: 'teams'
            },
            recentResults: {
                dbRef: 'recentResults',
                formId: 'recentResults-form',
                titleField: 'match'
            },
            news: {
                dbRef: 'news',
                formId: 'news-form',
                titleField: 'title'
            },
            players: {
                dbRef: 'players',
                formId: 'players-form',
                titleField: 'name'
            },
            sponsors: {
                dbRef: 'sponsors',
                formId: 'sponsors-form',
                titleField: 'name'
            }
        };
        let currentSection = 'upcomingGames';
        
        // --- FUNÇÃO PARA TRADUZIR ERROS DO FIREBASE AUTH ---
        function getFirebaseErrorMessage(errorCode) {
             switch (errorCode) {
                case 'auth/invalid-email':
                    return 'O endereço de e-mail está mal formatado.';
                case 'auth/user-not-found':
                case 'auth/wrong-password':
                    return 'E-mail ou senha inválidos.';
                case 'auth/too-many-requests':
                    return 'Acesso bloqueado temporariamente devido a muitas tentativas falhadas.';
                default:
                    console.error("Firebase Auth Error:", errorCode);
                    return 'Ocorreu um erro desconhecido. Tente novamente.';
            }
        }
        
        // --- FUNÇÃO DE LOGOUT ---
        window.logout = () => {
            signOut(auth).then(() => {
                alert('Logout realizado com sucesso!');
                document.getElementById('admin-panel').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex'; // Mostra a tela de login
                // Limpa os campos após o logout
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                document.getElementById('login-error').style.display = 'none';
            }).catch((error) => {
                console.error("Logout Error:", error);
                alert('Erro ao fazer logout.');
            });
        }

        // --- LÓGICA DE LOGIN (AGORA COM FIREBASE AUTH) --- 
        const loginForm = document.getElementById('login-form');
        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        const loginError = document.getElementById('login-error');

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault(); 
            
            // Pega os valores dos campos (agora com id 'email')
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const email = emailInput.value;
            const password = passwordInput.value;
            
            loginError.style.display = 'none'; // Esconde erros anteriores

            // Chama a função de login do Firebase
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    // Login bem-sucedido
                    loginScreen.style.display = 'none'; // Esconde a tela de login
                    adminPanel.style.display = 'block'; // Mostra o painel admin
                    
                    // Inicializa a funcionalidade do painel admin APÓS o login
                    initializeAdminPanel(); 
                })
                .catch((error) => {
                    // Login falhou
                    loginError.textContent = 'Erro de Login: ' + getFirebaseErrorMessage(error.code);
                    loginError.style.display = 'block'; 
                    passwordInput.value = ''; // Limpa a senha
                    emailInput.focus();
                });
        });

        // --- CÓDIGO DO PAINEL ADMIN (FUNÇÃO initializeAdminPanel REVISADA) ---
        function initializeAdminPanel() {
            // A inicialização do Firebase foi movida para fora desta função, 
            // garantindo que 'database' e 'auth' estejam disponíveis globalmente.
            // O restante do código de administração permanece o mesmo.

            // ... Seu código original para gerenciar o painel:
            window.showForm = (sectionName) => {
                currentSection = sectionName;
                document.querySelectorAll('.form-section').forEach(form => {
                    form.classList.add('hidden');
                });
                document.getElementById(`form-${sectionName}`).classList.remove('hidden');
                clearForm(currentSection);
                loadData(currentSection);
            };

            window.clearForm = (sectionName) => {
                const form = document.getElementById(sections[sectionName].formId);
                form.reset();
                const idInput = form.elements[`${sectionName}-id`];
                if (idInput) idInput.value = ''; // Limpa o ID em modo de edição
                const button = form.querySelector('button[type="submit"]');
                if (button) button.textContent = 'Adicionar / Salvar';
            };

            window.loadData = (sectionName) => {
                const display = document.getElementById('data-display');
                display.innerHTML = '<p>Carregando dados...</p>';
                
                onValue(ref(database, sections[sectionName].dbRef), (snapshot) => {
                    display.innerHTML = '';
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        Object.keys(data).forEach(key => {
                            const title = data[key][sections[sectionName].titleField];
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'bg-gray-700 p-3 rounded flex justify-between items-center mb-2';
                            itemDiv.innerHTML = `<span>${title}</span><div><button onclick="editItem('${key}')" class="btn btn-secondary py-1 px-2 text-sm mr-2">Editar</button><button onclick="deleteItem('${key}')" class="btn btn-danger py-1 px-2 text-sm">Excluir</button></div>`;
                            display.appendChild(itemDiv);
                        });
                    } else {
                        display.innerHTML = '<p>Nenhum dado encontrado.</p>';
                    }
                });
            };

            function handleFormSubmit(event) {
                event.preventDefault();
                const section = sections[currentSection];
                const form = event.target;
                const idInput = form.elements[`${currentSection}-id`]; // Acessa o input hidden pelo ID padrão
                const id = idInput ? idInput.value : null; // Pega o valor se o input existir
                const data = {};
                for (const element of form.elements) {
                    if (element.name && element.name !== 'id') {
                        let value = element.value;
                        // Lógica de manipulação de data/hora
                        if (currentSection === 'upcomingGames' || currentSection === 'recentResults') {
                            if (element.name === 'date-input') {
                                data.date = value; // Guarda a data separadamente por enquanto
                                continue;
                            } else if (element.name === 'time-input') {
                                if (data.date) {
                                    // Combina data e hora para criar um timestamp
                                    const combinedDateTime = new Date(`${data.date}T${value}:00`);
                                    data.date = combinedDateTime.getTime();
                                }
                                continue;
                            }
                        }
                        // Lógica para combinar URL
                        if ((currentSection === 'news' || currentSection === 'sponsors') && element.name === 'image-final') {
                            const baseUrl = document.getElementById(`${currentSection}-baseUrl`).innerText;
                            value = baseUrl + value;
                            data.image = value;
                            continue;
                        }
                        
                        // Garante que a data correta seja salva para 'news'
                         if (currentSection === 'news' && element.name === 'date') {
                            data.date = new Date(value).getTime();
                            continue;
                        }
                        
                        data[element.name] = value;
                    }
                }
                
                const dbPath = id ? ref(database, `${section.dbRef}/${id}`) : push(ref(database, section.dbRef));
                const operation = set(dbPath, data);
                
                operation
                    .then(() => alert(`Item ${id ? 'salvo' : 'adicionado'} com sucesso!`))
                    .catch(error => alert(error.message))
                    .finally(() => clearForm(currentSection));
            }

            window.editItem = (key) => {
                const section = sections[currentSection];
                get(ref(database, `${section.dbRef}/${key}`)).then((snapshot) => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        const form = document.getElementById(section.formId);
                        
                        // 1. Define o ID para modo de edição
                        document.getElementById(`${currentSection}-id`).value = key;
                        form.querySelector('button[type="submit"]').textContent = 'Salvar Edição';

                        // 2. Preenche os campos
                        for (const element of form.elements) {
                            if (element.name) {
                                // Lógica para campos de URL combinada
                                if (element.name === 'image-final') {
                                    // A lógica de preenchimento de URL é tratada no snippet a seguir
                                    continue;
                                } 
                                // Lógica para campos de data/hora (que precisam ser separados)
                                else if (element.name === 'date-input' || element.name === 'time-input') {
                                    continue;
                                }
                                // Lógica para outros campos
                                else if (data[element.name] !== undefined) {
                                    element.value = data[element.name];
                                }
                                
                                // Caso especial para 'news-date'
                                if (currentSection === 'news' && element.name === 'date') {
                                    const dateObj = new Date(data.date);
                                    element.value = dateObj.toISOString().split('T')[0];
                                }
                            }
                        }
                        
                        // Lógica de preenchimento para data/hora separadas
                        if ((currentSection === 'upcomingGames' || currentSection === 'recentResults')) {
                            const dateObj = new Date(data.date);
                            document.getElementById(`${currentSection}-date-input`).value = dateObj.toISOString().split('T')[0];
                            document.getElementById(`${currentSection}-time-input`).value = dateObj.toTimeString().split(' ')[0].substring(0, 5);
                        }
                        
                        // Lógica de preenchimento para URL final
                        if ((currentSection === 'news' || currentSection === 'sponsors') && data.image) {
                            const baseUrlElement = document.getElementById(`${currentSection}-baseUrl`);
                            const urlFinalElement = document.getElementById(`${currentSection}-image-final`);
                            if (baseUrlElement && urlFinalElement) {
                                const baseUrl = baseUrlElement.innerText;
                                if (data.image.startsWith(baseUrl)) {
                                    urlFinalElement.value = data.image.substring(baseUrl.length);
                                } else {
                                    urlFinalElement.value = data.image;
                                }
                            }
                        }

                        window.scrollTo(0, 0); // Rola para o topo para ver o formulário
                    }
                });
            };

            window.deleteItem = (key) => {
                if (confirm('Tem certeza que deseja excluir este item?')) {
                    remove(ref(database, `${sections[currentSection].dbRef}/${key}`))
                        .then(() => alert('Item excluído com sucesso!'))
                        .catch(error => alert(error.message));
                }
            };

            // --- FUNÇÕES DE BACKUP E RESTAURAÇÃO ---
            window.backupData = async () => { /* ... código ... */ };
            window.triggerRestore = () => { /* ... código ... */ };
            window.restoreData = (event) => { /* ... código ... */ };
            
            window.backupData = async () => {
                try {
                    const snapshot = await get(ref(database));
                    if (!snapshot.exists()) {
                        alert("Nenhum dado para fazer backup.");
                        return;
                    }
                    const data = snapshot.val();
                    const jsonData = JSON.stringify(data, null, 2);
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    const date = new Date().toISOString().slice(0, 10);
                    a.download = `backup-kendencefc-${date}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    alert("Backup realizado com sucesso! Verifique sua pasta de downloads.");
                } catch (error) {
                    alert("Erro ao fazer backup: " + error.message);
                }
            };
            
            window.triggerRestore = () => {
                document.getElementById('restore-file-input').click();
            };

            window.restoreData = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (confirm('ATENÇÃO: Restaurar o backup substituirá TODOS os dados existentes. Deseja continuar?')) {
                            // Define o objeto raiz no Firebase com os dados do backup
                            set(ref(database), data)
                                .then(() => {
                                    alert("Restauração concluída com sucesso!");
                                    // Recarrega os dados da seção atual após a restauração
                                    loadData(currentSection); 
                                })
                                .catch(error => alert("Erro ao restaurar dados: " + error.message));
                        }
                    } catch (error) {
                        alert("Erro ao ler o arquivo: Formato JSON inválido.");
                    }
                };
                reader.readAsText(file);
                // Limpa o input file para que o mesmo arquivo possa ser re-selecionado
                event.target.value = ''; 
            };
            

            function setupFormNames() {
                Object.keys(sections).forEach(sectionName => {
                    const form = document.getElementById(sections[sectionName].formId);
                    for (const element of form.elements) {
                        // Atribui 'name' baseado no 'id', removendo o prefixo da seção e sufixos comuns
                        // Ignora o input hidden de ID
                        if (element.id && !element.name && element.type !== 'hidden') { 
                           let name = element.id.replace(`${sectionName}-`, '').replace('-input', '');
                           // Caso especial para textareas ou outros elementos sem sufixo padrão
                           if (name === element.id) name = element.id.replace(`${sectionName}-`, ''); 
                           element.name = name;
                        }
                    }
                });
            }
            
            // --- INICIALIZAÇÃO DO PAINEL ADMIN ---
            setupFormNames();
            Object.keys(sections).forEach(key => {
                document.getElementById(sections[key].formId).addEventListener('submit', handleFormSubmit);
            });
            showForm(currentSection); // Mostra o formulário inicial
        }
        // --- FIM DO CÓDIGO DO PAINEL ADMIN ---
    </script>
</body>
</html>
